{"ast":null,"code":"var _jsxFileName = \"/Users/christy/Documents/cxxxxxn.github.io/src/views/NoteDetail/Mnavbar.js\";\nimport React, { Component } from 'react';\nimport './Mnavbar.css';\nexport class MarkdownNavbar extends Component {\n  constructor(props) {\n    super(props);\n\n    this.winScroll = () => {\n      if (this.scrollEventLock) return;\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;\n      const newHeadingList = this.getHeadingList().map(h => ({ ...h,\n        distanceToTop: Math.abs(scrollTop + this.props.headingTopOffset - h.offsetTop)\n      }));\n      const distanceList = newHeadingList.map(h => h.distanceToTop);\n      const minDistance = Math.min(...distanceList);\n      const curHeading = newHeadingList.find(h => h.distanceToTop === minDistance);\n      this.setState({\n        currentListNo: curHeading.listNo\n      });\n    };\n\n    this.state = {\n      currentListNo: ''\n    };\n  }\n\n  componentDidMount() {\n    if (this.addTargetTimeout) {\n      clearTimeout(this.addTargetTimeout);\n    }\n\n    this.addTargetTimeout = setTimeout(() => {\n      this.initHeadingsId();\n      document.addEventListener('scroll', this.winScroll, false);\n    }, 500);\n  }\n\n  shouldComponentUpdate(nextProps) {\n    if (nextProps.source !== this.props.source) {\n      if (this.scrollEventLockTimer) {\n        clearTimeout(this.scrollEventLockTimer);\n      }\n\n      this.scrollEventLock = true;\n      window.scrollTo(0, 0); // window.history.replaceState(\n      //     {},\n      //     '',\n      //     `${window.location.pathname}${window.location.search}`\n      // );\n\n      this.setState({\n        currentListNo: ''\n      });\n      const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');\n      Array.prototype.slice.apply(headings).forEach(h => h.dataset.id = '');\n      this.scrollEventLockTimer = setTimeout(() => {\n        this.initHeadingsId();\n        this.scrollEventLock = false;\n      }, 500);\n    }\n\n    return true;\n  }\n\n  componentWillUnmount() {\n    if (this.addTargetTimeout) {\n      clearTimeout(this.addTargetTimeout);\n    }\n\n    if (this.scrollTimeout) {\n      clearTimeout(this.scrollTimeout);\n    }\n\n    document.removeEventListener('scroll', this.winScroll, false);\n  }\n\n  getNavStructure() {\n    const contentWithoutCode = this.props.source.replace(/^[^#]+\\n/g, '').replace(/^#\\s[^#\\n]*\\n+/, '').replace(/```[^`\\n]*\\n+[^```]+```\\n+/g, '').replace(/`([^`\\n]+)`/g, '$1').replace(/\\*\\*?([^*\\n]+)\\*\\*?/g, '$1').replace(/__?([^_\\n]+)__?/g, '$1').trim();\n    const pattOfTitle = /#+\\s([^#\\n]+)\\n*/g;\n    const matchResult = contentWithoutCode.match(pattOfTitle);\n\n    if (!matchResult) {\n      return [];\n    }\n\n    const navData = matchResult.map((r, i) => ({\n      index: i,\n      level: r.match(/^#+/g)[0].length,\n      text: r.replace(pattOfTitle, '$1')\n    }));\n\n    const levelCount = level => navData.filter(r => r.level === level).length;\n\n    let startLevel = 1;\n    let startLevelCount = levelCount(startLevel);\n\n    while (!startLevelCount) {\n      startLevel += 1;\n      startLevelCount = levelCount(startLevel);\n    }\n\n    let listNo = 1;\n    navData.forEach(t => {\n      if (t.level === startLevel) {\n        t.listNo = listNo.toString();\n        listNo += 1;\n      }\n    });\n    navData.forEach((t, i) => {\n      if (!t.listNo) {\n        if (navData[i - 1] && t.level === navData[i - 1].level + 1) {\n          t.listNo = `${navData[i - 1].listNo}.1`;\n        } else if (navData[i - 1] && t.level === navData[i - 1].level) {\n          t.listNo = navData[i - 1].listNo.replace(/^(.+\\.)(\\d+)$/g, (w, $1, $2) => `${$1}${parseInt($2, 10) + 1}`);\n        } else {\n          t.listNo = '';\n        }\n      }\n    });\n    const result = navData.map(nav => ({ ...nav,\n      listNo: nav.listNo.indexOf('.') < 0 ? `${nav.listNo}.` : nav.listNo,\n      text: nav.text\n    }));\n    return result;\n  }\n\n  scrollToTarget(dataId) {\n    if (this.scrollTimeout) {\n      clearTimeout(this.scrollTimeout);\n    }\n\n    this.scrollTimeout = setTimeout(() => {\n      const target = document.querySelector(`[data-id=\"${dataId}\"]`);\n\n      if (target && typeof target.offsetTop === 'number') {\n        window.scrollTo(0, target.offsetTop - this.props.headingTopOffset);\n      }\n    }, 0);\n  }\n\n  initHeadingsId() {\n    const headingId = decodeURIComponent('');\n    this.getNavStructure().forEach(t => {\n      const headings = document.querySelectorAll(`h${t.level}`);\n      const curHeading = Array.prototype.slice.apply(headings).find(h => h.innerText === t.text && (!h.dataset || !h.dataset.id));\n\n      if (curHeading) {\n        curHeading.dataset.id = `heading-${t.index}`;\n\n        if (headingId && headingId === curHeading.dataset.id) {\n          this.scrollToTarget(headingId);\n          this.setState({\n            currentListNo: t.listNo\n          });\n        }\n      }\n    });\n  }\n\n  getHeadingList() {\n    const headingList = [];\n    this.getNavStructure().forEach(t => {\n      const headings = document.querySelectorAll(`h${t.level}`);\n      const curHeading = Array.prototype.slice.apply(headings).find(h => h.innerText === t.text && !headingList.find(x => x.offsetTop === h.offsetTop));\n\n      if (curHeading) {\n        headingList.push({\n          dataId: `heading-${t.index}`,\n          listNo: t.listNo,\n          offsetTop: curHeading.offsetTop\n        });\n      }\n    });\n    return headingList;\n  }\n\n  render() {\n    const tBlocks = this.getNavStructure().map(t => {\n      const cls = `title-anchor title-level${t.level} ${this.state.currentListNo === t.listNo ? 'active' : ''}`;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: cls,\n        onClick: evt => {\n          const currentHash = `heading-${t.index}`; // Nav item clicking callback\n\n          this.props.onNavItemClick(evt, evt.target, currentHash);\n          this.scrollToTarget(currentHash);\n          this.setState({\n            currentListNo: t.listNo\n          });\n        },\n        key: `title_anchor_${t.index}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 17\n        }\n      }, this.props.ordered ? /*#__PURE__*/React.createElement(\"small\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 43\n        }\n      }, t.listNo) : null, t.text);\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: `markdown-navigation ${this.props.className}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }\n    }, tBlocks);\n  }\n\n}\nMarkdownNavbar.defaultProps = {\n  source: '',\n  ordered: false,\n  headingTopOffset: 0,\n  declarative: false,\n  className: '',\n  onNavItemClick: () => {}\n};\nexport default MarkdownNavbar;","map":{"version":3,"sources":["/Users/christy/Documents/cxxxxxn.github.io/src/views/NoteDetail/Mnavbar.js"],"names":["React","Component","MarkdownNavbar","constructor","props","winScroll","scrollEventLock","scrollTop","window","pageYOffset","document","documentElement","body","newHeadingList","getHeadingList","map","h","distanceToTop","Math","abs","headingTopOffset","offsetTop","distanceList","minDistance","min","curHeading","find","setState","currentListNo","listNo","state","componentDidMount","addTargetTimeout","clearTimeout","setTimeout","initHeadingsId","addEventListener","shouldComponentUpdate","nextProps","source","scrollEventLockTimer","scrollTo","headings","querySelectorAll","Array","prototype","slice","apply","forEach","dataset","id","componentWillUnmount","scrollTimeout","removeEventListener","getNavStructure","contentWithoutCode","replace","trim","pattOfTitle","matchResult","match","navData","r","i","index","level","length","text","levelCount","filter","startLevel","startLevelCount","t","toString","w","$1","$2","parseInt","result","nav","indexOf","scrollToTarget","dataId","target","querySelector","headingId","decodeURIComponent","innerText","headingList","x","push","render","tBlocks","cls","evt","currentHash","onNavItemClick","ordered","className","defaultProps","declarative"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './Mnavbar.css';\n\nexport class MarkdownNavbar extends Component {\n    static defaultProps = {\n        source: '',\n        ordered: false,\n        headingTopOffset: 0,\n        declarative: false,\n        className: '',\n        onNavItemClick: () => {},\n    };\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            currentListNo: '',\n        };\n    }\n\n    componentDidMount() {\n        if (this.addTargetTimeout) {\n            clearTimeout(this.addTargetTimeout);\n        }\n            this.addTargetTimeout = setTimeout(() => {\n            this.initHeadingsId();\n            document.addEventListener('scroll', this.winScroll, false);\n        }, 500);\n    }\n\n    shouldComponentUpdate(nextProps) {\n        if (nextProps.source !== this.props.source) {\n            if (this.scrollEventLockTimer) {\n                clearTimeout(this.scrollEventLockTimer);\n            }\n            this.scrollEventLock = true;\n\n            window.scrollTo(0, 0);\n            // window.history.replaceState(\n            //     {},\n            //     '',\n            //     `${window.location.pathname}${window.location.search}`\n            // );\n            this.setState({\n                currentListNo: '',\n            });\n\n            const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');\n            Array.prototype.slice.apply(headings).forEach(h => (h.dataset.id = ''));\n\n            this.scrollEventLockTimer = setTimeout(() => {\n                this.initHeadingsId();\n                this.scrollEventLock = false;\n            }, 500);\n        }\n        return true;\n    }\n\n    componentWillUnmount() {\n        if (this.addTargetTimeout) {\n            clearTimeout(this.addTargetTimeout);\n        }\n        if (this.scrollTimeout) {\n            clearTimeout(this.scrollTimeout);\n        }\n        document.removeEventListener('scroll', this.winScroll, false);\n    }\n\n    getNavStructure() {\n        const contentWithoutCode = this.props.source\n        .replace(/^[^#]+\\n/g, '')\n        .replace(/^#\\s[^#\\n]*\\n+/, '')\n        .replace(/```[^`\\n]*\\n+[^```]+```\\n+/g, '')\n        .replace(/`([^`\\n]+)`/g, '$1')\n        .replace(/\\*\\*?([^*\\n]+)\\*\\*?/g, '$1')\n        .replace(/__?([^_\\n]+)__?/g, '$1')\n        .trim();\n\n        const pattOfTitle = /#+\\s([^#\\n]+)\\n*/g;\n        const matchResult = contentWithoutCode.match(pattOfTitle);\n\n        if (!matchResult) {\n        return [];\n        }\n\n        const navData = matchResult.map((r, i) => ({\n        index: i,\n        level: r.match(/^#+/g)[0].length,\n        text: r.replace(pattOfTitle, '$1'),\n        }));\n\n        const levelCount = level => navData.filter(r => r.level === level).length;\n        let startLevel = 1;\n        let startLevelCount = levelCount(startLevel);\n        while (!startLevelCount) {\n        startLevel += 1;\n        startLevelCount = levelCount(startLevel);\n        }\n\n        let listNo = 1;\n        navData.forEach(t => {\n        if (t.level === startLevel) {\n            t.listNo = listNo.toString();\n            listNo += 1;\n        }\n        });\n\n        navData.forEach((t, i) => {\n        if (!t.listNo) {\n            if (navData[i - 1] && t.level === navData[i - 1].level + 1) {\n            t.listNo = `${navData[i - 1].listNo}.1`;\n            } else if (navData[i - 1] && t.level === navData[i - 1].level) {\n            t.listNo = navData[i - 1].listNo.replace(\n                /^(.+\\.)(\\d+)$/g,\n                (w, $1, $2) => `${$1}${parseInt($2, 10) + 1}`\n            );\n            } else {\n            t.listNo = '';\n            }\n        }\n        });\n\n        const result = navData.map(nav => ({\n        ...nav,\n        listNo: nav.listNo.indexOf('.') < 0 ? `${nav.listNo}.` : nav.listNo,\n        text: nav.text,\n        }));\n\n        return result;\n    }\n\n    scrollToTarget(dataId) {\n        if (this.scrollTimeout) {\n        clearTimeout(this.scrollTimeout);\n        }\n\n        this.scrollTimeout = setTimeout(() => {\n        const target = document.querySelector(`[data-id=\"${dataId}\"]`);\n        if (target && typeof target.offsetTop === 'number') {\n            window.scrollTo(0, target.offsetTop - this.props.headingTopOffset);\n        }\n        }, 0);\n    }\n\n    initHeadingsId() {\n        const headingId = decodeURIComponent('');\n\n        this.getNavStructure().forEach(t => {\n        const headings = document.querySelectorAll(`h${t.level}`);\n        const curHeading = Array.prototype.slice\n            .apply(headings)\n            .find(h => h.innerText === t.text && (!h.dataset || !h.dataset.id));\n\n        if (curHeading) {\n            curHeading.dataset.id = `heading-${t.index}`;\n\n            if (headingId && headingId === curHeading.dataset.id) {\n            this.scrollToTarget(headingId);\n            this.setState({\n                currentListNo: t.listNo,\n            });\n            }\n        }\n        });\n    }\n\n    getHeadingList() {\n        const headingList = [];\n\n        this.getNavStructure().forEach(t => {\n        const headings = document.querySelectorAll(`h${t.level}`);\n        const curHeading = Array.prototype.slice\n            .apply(headings)\n            .find(\n            h =>\n                h.innerText === t.text &&\n                !headingList.find(x => x.offsetTop === h.offsetTop)\n            );\n        if (curHeading) {\n            headingList.push({\n            dataId: `heading-${t.index}`,\n            listNo: t.listNo,\n            offsetTop: curHeading.offsetTop,\n            });\n        }\n        });\n\n        return headingList;\n    }\n\n    winScroll = () => {\n        if (this.scrollEventLock) return;\n\n        const scrollTop =\n            window.pageYOffset ||\n            document.documentElement.scrollTop ||\n            document.body.scrollTop ||\n            0;\n\n        const newHeadingList = this.getHeadingList().map(h => ({\n            ...h,\n            distanceToTop: Math.abs(\n                scrollTop + this.props.headingTopOffset - h.offsetTop\n            ),\n            }));\n            const distanceList = newHeadingList.map(h => h.distanceToTop);\n            const minDistance = Math.min(...distanceList);\n            const curHeading = newHeadingList.find(\n            h => h.distanceToTop === minDistance\n        );\n\n        this.setState({\n            currentListNo: curHeading.listNo,\n        });\n    };\n\n    render() {\n        const tBlocks = this.getNavStructure().map(t => {\n            const cls = `title-anchor title-level${t.level} ${\n                this.state.currentListNo === t.listNo ? 'active' : ''\n            }`;\n\n            return (\n                <div\n                    className={cls}\n                    onClick={evt => {\n                        const currentHash = `heading-${t.index}`;\n\n                        // Nav item clicking callback\n                        this.props.onNavItemClick(evt, evt.target, currentHash);\n                        this.scrollToTarget(currentHash);\n                        this.setState({\n                            currentListNo: t.listNo,\n                        });\n                    }}\n                    key={`title_anchor_${t.index}`}>\n                    {this.props.ordered ? <small>{t.listNo}</small> : null}\n                    {t.text}\n                </div>\n            );\n        });\n\n        return (\n        <div className={`markdown-navigation ${this.props.className}`}>\n            {tBlocks}\n        </div>\n        );\n    }\n}\n\nexport default MarkdownNavbar;\n"]},"metadata":{},"sourceType":"module"}